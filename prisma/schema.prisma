  // This is your Prisma schema file,
  // learn more about it in the docs: https://pris.ly/d/prisma-schema

  // ====================================================================================================================================
  //                                                                  GENERATE PRISMA CLIENT TO COMMUNICATE WITH DATABASE
  // ====================================================================================================================================
  generator client {
    provider = "prisma-client-js"  
  }

  // ====================================================================================================================================
  //                                                                  IDENTIFY MONGODB ENDPOINT FOR PRISMA CLIENT API 
  // ====================================================================================================================================
  datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
  }

  // ====================================================================================================================================
  //                                                                   ENUMERATE STORAGE
  // ====================================================================================================================================
  // ============================================
  // Category Attribute Type Enum
  // ============================================
  enum AttributeType {
    TEXT
    NUMBER
    SELECT
    MULTI_SELECT
    COLOR
  }
  // ============================================
  // Product Variant Status Enum
  // ============================================
  enum VariantStatus {
    ACTIVE
    INACTIVE
    OUT_OF_STOCK
  }

  // ====================================================================================================================================
  //                                                                   Category Models
  // ====================================================================================================================================
  model Category {
    id          String    @id @default(auto()) @map("_id") @db.ObjectId
    name        String    @unique
    slug        String    @unique
    description String?
    icon        String?
    parentId    String?   @db.ObjectId
    parent      Category? @relation("SubCategories", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    children    Category[] @relation("SubCategories")
    
    attributes  CategoryAttribute[]
    products    Product[]  @relation("categoryProducts")  
    
    isActive    Boolean   @default(true)
    order       Int       @default(0)
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt
  }


  // ====================================================================================================================================
  //                                                                   Category Attribute Model
  // ====================================================================================================================================
  model CategoryAttribute {
    id          String   @id @default(auto()) @map("_id") @db.ObjectId
    categoryId  String   @db.ObjectId
    category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
    
    name        String   
    type        AttributeType @default(TEXT)
    isRequired  Boolean  @default(false)
    order       Int      @default(0)

    values      String[] 
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    
    @@unique([categoryId, name])
  }


  // ====================================================================================================================================
  //                                                                   User Model
  // ====================================================================================================================================
  model User {
    phonenumber  String?
    userName     String?
    id           String    @id @map("_id") @default(auto()) @db.ObjectId
    email        String    @unique
    name         String?
    products     Product[] @relation("userProducts")
    password     String 
    accessToken  String?
    refreshToken String?
    
  }


  // ====================================================================================================================================
  //                                                                   Seller Model
  // ====================================================================================================================================
  model Seller {
    id        String    @id @map("_id") @default(auto()) @db.ObjectId
    storeName String
    products  Product[] @relation("sellerProducts")
    
  }


  // ====================================================================================================================================
  //                                                                   Warehouse Model
  // ====================================================================================================================================
  model Warehouse {
    id                String    @id @map("_id") @default(auto()) @db.ObjectId
    name              String    @unique
    warehouseId       String 
    address           String
    city              String
    isActive          Boolean   @default(true)
    createdAt         DateTime  @default(now()) 
    updateAt          DateTime  @updatedAt
    productVariants   ProductVariant[]

    @@index([warehouseId])
    @@index([isActive])
  }


  // ====================================================================================================================================
  //                                                                   Product Model
  // ====================================================================================================================================
  model Product {
    id             String    @id @map("_id") @default(auto()) @db.ObjectId
    productId      String    
    
    // Relations
    userId         String?   @db.ObjectId
    user           User?     @relation("userProducts", fields: [userId], references: [id])
    
    variants       ProductVariant[]

    sellerId       String?   @db.ObjectId
    seller         Seller?   @relation("sellerProducts", fields: [sellerId], references: [id])
    
    categoryId     String?   @db.ObjectId  
    category       Category? @relation("categoryProducts", fields: [categoryId], references: [id])
    
    // Product details
    title          String
    image          String?   // primary image URL
    description    String?   // long text / HTML
    price          Float
    old_price      Float?
    specifications Json?     // JSON object for flexible attributes: { color: "red", size: ["S","M"] }
    type           String?   // e.g., "physical" | "digital" | "service"
    stock_count    Int       @default(0)
    life           String?   // shelf life / warranty text
    mfd            DateTime? // manufacture date
    in_stock       Boolean   @default(true)
    featured       Boolean   @default(false)
    digital        Boolean   @default(false)
    sku            String?

    // Relation
    medias         ProductImage[]  
    videos         ProductVideo[]

    // Timestamps
    date           DateTime  @default(now()) 
    updated        DateTime  @updatedAt

    @@index([productId], name: "productId_idx")
    @@index([sku], name: "sku_idx")
    @@index([title], name: "title_idx")
    @@index([categoryId])  // Added index for category
  }

  // ====================================================================================================================================
  //                                                                   Product Image Model
  // ====================================================================================================================================
  model ProductImage {
  id        String   @id @map("_id") @default(auto()) @db.ObjectId
  productId String   @db.ObjectId
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  url       String
  alt       String?
  type      String   @default("image")
  order     Int      @default(0)
  
  createdAt DateTime @default(now())
  
  @@index([productId])
  @@index([order])
}

  // ====================================================================================================================================
  //                                                                   Product Video
  // ====================================================================================================================================
  model ProductVideo {
  id        String   @id @map("_id") @default(auto()) @db.ObjectId
  productId String   @db.ObjectId
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  url       String
  alt       String?
  type      String   @default("image")
  order     Int      @default(0)
  
  createdAt DateTime @default(now())
  
  @@index([productId])
  @@index([order])
}


  // ====================================================================================================================================
  //                                                                   Cart Order Model
  // ====================================================================================================================================
  model CartOrder {
    id                       String    @id @default(auto()) @map("_id") @db.ObjectId
    user_id                  String?
    full_name                String?
    email                    String?
    phone                    String?
    address                  String?
    city                     String?
    state                    String?
    country                  String?

    price                    Float?
    saved                    Boolean?  @default(false)

    shipping_method          String?
    tracking_id              String?
    tracking_website_address String?

    paid_status              String?   // e.g. pending, paid, cancelled
    order_date               DateTime?
    date                     DateTime? // if both exist

    product_status           String?   // e.g. processing, shipped, delivered
    sku                      String?
    oid                      String?   // external order id (if any)

    stripe_payment_intent    String?   // optional

  }


  // ====================================================================================================================================
  //                                                                   Product Variants
  // ====================================================================================================================================
model ProductVariant {
  id          String   @id @map("_id") @default(auto()) @db.ObjectId
  productId   String   @db.ObjectId
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  sku         String   @unique  
  name        String  

  attributes  Json     
  
  price       Float
  costPrice   Float
  oldPrice    Float?   
  
  warehouseId String   @db.ObjectId
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
  quantity    Int      @default(0)
  lowStock    Int      @default(10)
  
  status      VariantStatus @default(ACTIVE)
  isPublished Boolean  @default(false)
  
  medias      VariantMedia[]

  weight      Float?  
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([productId])
  @@index([warehouseId])
  @@index([status])
  @@index([isPublished])
  @@index([quantity]) 
}

model VariantMedia {
  id        String         @id @map("_id") @default(auto()) @db.ObjectId
  variantId String         @db.ObjectId
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  
  url       String
  alt       String?
  order     Int            @default(0)
  
  createdAt DateTime       @default(now())
  
  @@index([variantId])
  @@index([order])
}